let expectingRoll = false;

const attendanceData = {
    "21A01": 82,
    "21A02": 68,
    "21A03": 90,
    "21A04": 74,
    "21A05": 88
};

function sendMessage() {
    let input = document.getElementById("userInput");
    let message = input.value.trim().toLowerCase();
    let chatBox = document.getElementById("chatBox");

    if (message === "") return;

    // User message
    chatBox.innerHTML += `
        <div class="user">
            <span>${input.value}</span>
        </div>
    `;

    input.value = "";

    let reply = "";

    if (expectingRoll) {
        let roll = message.toUpperCase();
        if (attendanceData[roll] !== undefined) {
            let att = attendanceData[roll];
            reply = `üìä Attendance for ${roll} is ${att}%.`;
            reply += att < 75
                ? " ‚ö† Warning: Attendance below minimum!"
                : " ‚úÖ You are eligible for exams.";
        } else {
            reply = "‚ùå Roll number not found.";
        }
        expectingRoll = false;
    }
    else if (message.includes("attendance")) {
        reply = "Please enter your roll number.";
        expectingRoll = true;
    }
    else if (message.includes("minimum")) {
        reply = "‚úÖ Minimum attendance required is 75%.";
    }
    else if (message.includes("rules")) {
        reply = "üìå Students with attendance below 75% are not allowed for exams.";
    }
    else if (message.includes("help")) {
        reply = `
üìå Available commands:<br>
‚Ä¢ attendance<br>
‚Ä¢ minimum<br>
‚Ä¢ rules<br>
‚Ä¢ help
        `;
    }
    else if (message.includes("hi") || message.includes("hello")) {
        reply = "Hello üòä How can I help you?";
    }
    else {
        reply = "‚ùì Sorry, I didn‚Äôt understand. Type <b>help</b>.";
    }

    // Typing indicator
    chatBox.innerHTML += `
        <div class="bot" id="typing">
            <span>Bot is typing...</span>
        </div>
    `;
    chatBox.scrollTop = chatBox.scrollHeight;

    setTimeout(() => {
        document.getElementById("typing").remove();
        let time = new Date().toLocaleTimeString();
        chatBox.innerHTML += `
            <div class="bot">
                <span>${reply}</span>
                <small>${time}</small>
            </div>
        `;
        chatBox.scrollTop = chatBox.scrollHeight;
    }, 800);
}

// Enter key support
document.getElementById("userInput").addEventListener("keypress", function (e) {
    if (e.key === "Enter") {
        sendMessage();
    }
});

